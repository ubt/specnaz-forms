# üìä –û—Ç—á–µ—Ç –ø–æ –∞–Ω–∞–ª–∏–∑—É –ø—Ä–æ–µ–∫—Ç–∞ specnaz-forms

**–î–∞—Ç–∞ –∞–Ω–∞–ª–∏–∑–∞:** 2025-12-03
**–í–µ—Ä—Å–∏—è –ø—Ä–æ–µ–∫—Ç–∞:** 2.0.0

---

## 1Ô∏è‚É£ –ù–ï–†–ê–ë–û–ß–ò–ï –ò –ù–ï–ò–°–ü–û–õ–¨–ó–£–ï–ú–´–ï –ß–ê–°–¢–ò –ö–û–î–ê

### üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

#### 1.1. –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ KV –≤ `/app/api/batch/results/route.js:12`

```javascript
export async function GET(req, context) {
  initKV(context.env);  // ‚ùå –û–®–ò–ë–ö–ê! context.env –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ Next.js 15
```

**–ü—Ä–æ–±–ª–µ–º–∞:** –í Next.js 15 Edge Runtime –ø–∞—Ä–∞–º–µ—Ç—Ä `context.env` –Ω–µ –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è. –≠—Ç–∞ —Å—Ç—Ä–æ–∫–∞ –≤—ã–∑–æ–≤–µ—Ç –æ—à–∏–±–∫—É –ø—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ batch –æ–ø–µ—Ä–∞—Ü–∏–π.

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:** –£–±—Ä–∞—Ç—å –ø–µ—Ä–µ–¥–∞—á—É `context.env` (–∫–∞–∫ —ç—Ç–æ —É–∂–µ —Å–¥–µ–ª–∞–Ω–æ –≤ `status/route.js:16`)

```javascript
initKV(); // ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç
```

**–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `app/api/batch/results/route.js:12`

---

#### 1.2. –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ KV –æ—á–µ—Ä–µ–¥–∏

**–ü—Ä–æ–±–ª–µ–º–∞:** –í –ø—Ä–æ–µ–∫—Ç–µ —Å–æ–∑–¥–∞–µ—Ç—Å—è KV –æ—á–µ—Ä–µ–¥—å (`lib/kv-queue.js:117`), –∫—É–¥–∞ –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è batch –æ–ø–µ—Ä–∞—Ü–∏–∏, –ù–û –Ω–µ—Ç worker'–∞ –∏–ª–∏ scheduled job'–∞ –¥–ª—è –∏—Ö –æ–±—Ä–∞–±–æ—Ç–∫–∏!

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –æ—Ü–µ–Ω–∫–∏ ‚Üí —Å–æ–∑–¥–∞—é—Ç—Å—è jobs –≤ KV
- Frontend –º–æ–∂–µ—Ç poll —Å—Ç–∞—Ç—É—Å —á–µ—Ä–µ–∑ `/api/batch/status`
- ‚ùå –ù–æ —Å–∞–º–∏ –æ–ø–µ—Ä–∞—Ü–∏–∏ –ù–ò–ö–û–ì–î–ê –ù–ï –í–´–ü–û–õ–ù–Ø–Æ–¢–°–Ø –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏!

**–†–µ—à–µ–Ω–∏–µ:** –ù–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–æ–∑–¥–∞—Ç—å:
1. Cloudflare Worker –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—á–µ—Ä–µ–¥–∏
2. –ò–ª–∏ Cloudflare Cron Trigger –¥–ª—è –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏
3. –ò–ª–∏ –ø–µ—Ä–µ–π—Ç–∏ –Ω–∞ –ø—Ä—è–º—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É –±–µ–∑ –æ—á–µ—Ä–µ–¥–∏

---

### üü° –ù–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

#### 1.3. `cleanupKVQueue()` –≤ `lib/kv-queue.js:278`

–§—É–Ω–∫—Ü–∏—è –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–∞ –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ —Å—Ç–∞—Ä—ã—Ö –¥–∞–Ω–Ω—ã—Ö –∏–∑ KV (—Å—Ç–∞—Ä—à–µ 24 —á–∞—Å–æ–≤), –Ω–æ **–Ω–∏–≥–¥–µ –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è**.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
- –°–æ–∑–¥–∞—Ç—å Cloudflare Cron Trigger –¥–ª—è –µ–∂–µ–¥–Ω–µ–≤–Ω–æ–π –æ—á–∏—Å—Ç–∫–∏
- –ò–ª–∏ –≤—ã–∑—ã–≤–∞—Ç—å –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ –∏–∑ API endpoints

---

#### 1.4. `setEmployeeUrl()` –≤ `lib/notion.js:792`

–§—É–Ω–∫—Ü–∏—è –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ URL —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –ø—Ä–æ–µ–∫—Ç–µ.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –£–¥–∞–ª–∏—Ç—å –∏–ª–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–ª—è –±—É–¥—É—â–µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è.

---

#### 1.5. POST –º–µ—Ç–æ–¥ –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ –∫—ç—à–∞ –≤ `app/api/batch/status/route.js:258`

–ú–µ—Ç–æ–¥ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, –Ω–æ:
- –ù–µ –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω
- –ù–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ
- –ù–µ—Ç UI –¥–ª—è –µ–≥–æ –≤—ã–∑–æ–≤–∞

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –£–¥–∞–ª–∏—Ç—å –∏–ª–∏ –¥–æ–±–∞–≤–∏—Ç—å –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å.

---

### üü¢ –ù–µ–æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–π –∫–æ–¥

#### 1.6. –ë–µ—Å–ø–æ–ª–µ–∑–Ω–∞—è –ª–æ–≥–∏–∫–∞ batchSize –≤ `app/form/[token]/page.jsx:356-361`

```javascript
const batchOptions = {
  batchSize: operations.length <= 20 ? 20 : 50,  // ‚ùå –ë–µ—Å–ø–æ–ª–µ–∑–Ω–æ
  // ...
};
```

**–ü—Ä–æ–±–ª–µ–º–∞:** –ï—Å–ª–∏ –æ–ø–µ—Ä–∞—Ü–∏–π 15, —É—Å—Ç–∞–Ω–æ–≤–∫–∞ batchSize=20 –Ω–∏—á–µ–≥–æ –Ω–µ –º–µ–Ω—è–µ—Ç - –≤—Å–µ —Ä–∞–≤–Ω–æ –±—É–¥–µ—Ç –æ–¥–∏–Ω –±–∞—Ç—á —Ä–∞–∑–º–µ—Ä–æ–º 15.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –£–ø—Ä–æ—Å—Ç–∏—Ç—å –¥–æ:

```javascript
const batchOptions = {
  batchSize: 50,
  // ...
};
```

---

#### 1.7. –°–º–µ—à–∞–Ω–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ console.log –∏ logger

–ü–æ –≤—Å–µ–º—É –ø—Ä–æ–µ–∫—Ç—É –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∏ `console.log()`, –∏ `logger.*()`. –≠—Ç–æ –∑–∞—Ç—Ä—É–¥–Ω—è–µ—Ç –æ—Ç–ª–∞–¥–∫—É –∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é –ª–æ–≥–æ–≤.

**–ù–∞–π–¥–µ–Ω–æ –≤:**
- `app/api/batch/status/route.js` (—Å—Ç—Ä–æ–∫–∏ 12, 17, 68, 99, 108-110, 233)
- `app/api/batch/results/route.js` (—Å—Ç—Ä–æ–∫–∏ 13, 26, 64, 80, 136, 159, 211)

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –ó–∞–º–µ–Ω–∏—Ç—å –≤—Å–µ `console.log()` –Ω–∞ `logger.info()` –∏–ª–∏ `logger.debug()`

---

## 2Ô∏è‚É£ –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–Ø –°–ö–û–†–û–°–¢–ò –ó–ê–ì–†–£–ó–ö–ò –§–û–†–ú–´

### üìä –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ

**–í—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ä–º—ã** (–¥–ª—è —Ç–∏–ø–∏—á–Ω–æ–≥–æ —Å—Ü–µ–Ω–∞—Ä–∏—è - 3 —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞, 50 –Ω–∞–≤—ã–∫–æ–≤):
- –ë–µ–∑ –∫—ç—à–∞: **3-8 —Å–µ–∫—É–Ω–¥**
- –° –∫—ç—à–µ–º: **<100–º—Å**

**–£–∑–∫–∏–µ –º–µ—Å—Ç–∞:**

### üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

#### 2.1. –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –≤ `/api/form/[token]/route.js`

```javascript
// –°—Ç—Ä–æ–∫–∞ 58 - —Å–Ω–∞—á–∞–ª–∞ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∏
const employees = await listEvaluateesForReviewerUser(reviewerUserId);

// –°—Ç—Ä–æ–∫–∞ 74 - –∑–∞—Ç–µ–º –Ω–∞–≤—ã–∫–∏
const skillGroups = await fetchEmployeeSkillRowsForReviewerUser(employees, reviewerUserId);
```

**–ü—Ä–æ–±–ª–µ–º–∞:** –î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ. –î–ª—è –±–æ–ª—å—à–∏—Ö –∫–æ–º–∞–Ω–¥:
- –ó–∞–≥—Ä—É–∑–∫–∞ employees: 1-3 —Å–µ–∫
- –ó–∞–≥—Ä—É–∑–∫–∞ skills: 2-5 —Å–µ–∫
- **–ò—Ç–æ–≥–æ: 3-8 —Å–µ–∫—É–Ω–¥**

**–†–µ—à–µ–Ω–∏–µ:** –†–∞—Å–ø–∞—Ä–∞–ª–ª–µ–ª–∏—Ç—å –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ (–Ω–æ –≤ –¥–∞–Ω–Ω–æ–º —Å–ª—É—á–∞–µ skills –∑–∞–≤–∏—Å—è—Ç –æ—Ç employees).

---

#### 2.2. –ó–∞–≥—Ä—É–∑–∫–∞ –í–°–ï–• –Ω–∞–≤—ã–∫–æ–≤ —Å—Ä–∞–∑—É

–í `fetchEmployeeSkillRowsForReviewerUser` –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –≤—Å–µ —Å—Ç—Ä–æ–∫–∏ –º–∞—Ç—Ä–∏—Ü—ã –¥–ª—è –≤—Å–µ—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –æ–¥–Ω–∏–º –∑–∞–ø—Ä–æ—Å–æ–º.

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –î–ª—è 10 —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ √ó 20 –Ω–∞–≤—ã–∫–æ–≤ = 200 —Å—Ç—Ä–æ–∫ –º–∞—Ç—Ä–∏—Ü—ã
- Notion API –∏–º–µ–µ—Ç –ª–∏–º–∏—Ç –ø–∞–≥–∏–Ω–∞—Ü–∏–∏ (100 –∑–∞–ø–∏—Å–µ–π –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É)
- –≠—Ç–æ –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å 5-15 —Å–µ–∫—É–Ω–¥ –¥–ª—è –±–æ–ª—å—à–∏—Ö –∫–æ–º–∞–Ω–¥

**–†–µ—à–µ–Ω–∏–µ:**
```javascript
// –û–ø—Ü–∏—è 1: –õ–µ–Ω–∏–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –ø–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º
// –ó–∞–≥—Ä—É–∑–∏—Ç—å –ø–µ—Ä–≤–æ–≥–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ —Å—Ä–∞–∑—É, –æ—Å—Ç–∞–ª—å–Ω—ã—Ö - –ø–æ –∑–∞–ø—Ä–æ—Å—É

// –û–ø—Ü–∏—è 2: –ü–∞–≥–∏–Ω–∞—Ü–∏—è –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ
// –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –ø–æ 20-30 –Ω–∞–≤—ã–∫–æ–≤, –æ—Å—Ç–∞–ª—å–Ω—ã–µ –ø–æ–¥–≥—Ä—É–∂–∞—Ç—å –ø—Ä–∏ —Å–∫—Ä–æ–ª–ª–µ

// –û–ø—Ü–∏—è 3: Server-Side Streaming
// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å React Suspense + streaming –¥–ª—è –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏
```

---

#### 2.3. –û–≥—Ä–æ–º–Ω—ã–π —Ä–∞–∑–º–µ—Ä –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ —Ñ–æ—Ä–º—ã

`app/form/[token]/page.jsx` - **1576 —Å—Ç—Ä–æ–∫** –≤ –æ–¥–Ω–æ–º —Ñ–∞–π–ª–µ!

**–ü—Ä–æ–±–ª–µ–º—ã:**
- –ú–µ–¥–ª–µ–Ω–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è React –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞
- –ù–µ—Ç code splitting
- –í–µ—Å—å JavaScript –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è —Å—Ä–∞–∑—É

**–†–µ—à–µ–Ω–∏–µ:**
```javascript
// –†–∞–∑–¥–µ–ª–∏—Ç—å –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤:
// - FormHeader.jsx
// - EmployeeSkillGroup.jsx (—Å lazy loading)
// - SubmitPanel.jsx
// - useFormState.js (custom hook)

import dynamic from 'next/dynamic';

const EmployeeSkillGroup = dynamic(() => import('./EmployeeSkillGroup'), {
  loading: () => <div>–ó–∞–≥—Ä—É–∑–∫–∞...</div>,
  ssr: false
});
```

---

#### 2.4. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –≤–∏—Ä—Ç—É–∞–ª–∏–∑–∞—Ü–∏–∏ —Å–ø–∏—Å–∫–∞

–í—Å–µ –Ω–∞–≤—ã–∫–∏ —Ä–µ–Ω–¥–µ—Ä—è—Ç—Å—è —Å—Ä–∞–∑—É, –¥–∞–∂–µ –µ—Å–ª–∏ –≥—Ä—É–ø–ø—ã —Å–≤–µ—Ä–Ω—É—Ç—ã (collapsed).

**–ü—Ä–æ–±–ª–µ–º–∞:**
- 200 –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ ScoreRow –≤ DOM –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
- –ú–µ–¥–ª–µ–Ω–Ω—ã–π initial render
- –í—ã—Å–æ–∫–æ–µ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏

**–†–µ—à–µ–Ω–∏–µ:**
```bash
npm install react-window
```

```javascript
import { FixedSizeList } from 'react-window';

// –í–∏—Ä—Ç—É–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫ –Ω–∞–≤—ã–∫–æ–≤
<FixedSizeList
  height={600}
  itemCount={skills.length}
  itemSize={120}
>
  {({ index, style }) => (
    <div style={style}>
      <ScoreRow skill={skills[index]} />
    </div>
  )}
</FixedSizeList>
```

---

### üü° –°—Ä–µ–¥–Ω–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç

#### 2.5. –ù–µ–æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ

**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:**
- localStorage —Å TTL 60 –º–∏–Ω—É—Ç (—Å—Ç—Ä–æ–∫–∞ 8)
- –ö—ç—à –Ω–µ –∏–Ω–≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç—Å—è –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö

**–ü—Ä–æ–±–ª–µ–º—ã:**
1. –ï—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–∏–ª–∏—Å—å –≤ Notion, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ –¥–∞–Ω–Ω—ã–µ –¥–æ –∏—Å—Ç–µ—á–µ–Ω–∏—è TTL
2. TTL 60 –º–∏–Ω—É—Ç —Å–ª–∏—à–∫–æ–º –¥–æ–ª–≥–∏–π - –æ—Ü–µ–Ω–∫–∏ –º–æ–≥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è –¥—Ä—É–≥–∏–º–∏ –ª—é–¥—å–º–∏

**–†–µ—à–µ–Ω–∏–µ:**
```javascript
// –î–æ–±–∞–≤–∏—Ç—å –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∫—ç—à–∞
const CACHE_VERSION = '2.0';
const cacheKey = `skills_${token}_v${CACHE_VERSION}`;

// –î–æ–±–∞–≤–∏—Ç—å ETag –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏
const response = await fetch(`/api/form/${token}`, {
  headers: {
    'If-None-Match': cachedETag // –í–µ—Ä–Ω–µ—Ç 304 –µ—Å–ª–∏ –Ω–µ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å
  }
});

// –£–º–µ–Ω—å—à–∏—Ç—å TTL –¥–æ 10-15 –º–∏–Ω—É—Ç
const CACHE_TTL = 10 * 60 * 1000; // 10 –º–∏–Ω—É—Ç
```

---

#### 2.6. –ò–∑–±—ã—Ç–æ—á–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∫ Notion

–í `fetchEmployeeSkillRowsForReviewerUser` (lib/notion.js:620):
- –ó–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–∞–∂–¥–æ–º –Ω–∞–≤—ã–∫–µ –æ—Ç–¥–µ–ª—å–Ω–æ (—Ö–æ—Ç—å –∏ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ)
- –î–ª—è 100 —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –Ω–∞–≤—ã–∫–æ–≤ = 100 –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ Notion API

**–†–µ—à–µ–Ω–∏–µ:**
```javascript
// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–æ–ª–µ–µ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω–æ–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞–≤—ã–∫–æ–≤
// –ù–∞–≤—ã–∫–∏ —Ä–µ–¥–∫–æ –º–µ–Ω—è—é—Ç—Å—è - –º–æ–∂–Ω–æ –∫—ç—à–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ 24 —á–∞—Å–∞

const SKILLS_CACHE_TTL = 24 * 60 * 60 * 1000; // 24 —á–∞—Å–∞

// –ò–ª–∏ –∑–∞–≥—Ä—É–∂–∞—Ç—å –≤—Å–µ –Ω–∞–≤—ã–∫–∏ –æ–¥–Ω–∏–º –∑–∞–ø—Ä–æ—Å–æ–º –∏–∑ –ë–î –Ω–∞–≤—ã–∫–æ–≤
```

---

### üü¢ –ù–∏–∑–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç (–∫–∞—á–µ—Å—Ç–≤–æ –∂–∏–∑–Ω–∏)

#### 2.7. –ù–µ—Ç –∏–Ω–¥–∏–∫–∞—Ü–∏–∏ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –∑–∞–≥—Ä—É–∑–∫–∏

**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:** –ü—Ä–æ—Å—Ç–æ–π spinner —Å 4 —ç—Ç–∞–ø–∞–º–∏.

**–£–ª—É—á—à–µ–Ω–∏–µ:**
```javascript
// –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å —Ä–µ–∞–ª—å–Ω—ã–π –ø—Ä–æ–≥—Ä–µ—Å—Å
const [loadingProgress, setLoadingProgress] = useState(0);

// –ó–∞–≥—Ä—É–∑–∫–∞ employees - 30%
setLoadingProgress(30);

// –ó–∞–≥—Ä—É–∑–∫–∞ skills - –æ–±–Ω–æ–≤–ª—è—Ç—å –ø–æ –º–µ—Ä–µ –∑–∞–≥—Ä—É–∑–∫–∏ –±–∞—Ç—á–µ–π
for (let i = 0; i < batches.length; i++) {
  await loadBatch(batches[i]);
  setLoadingProgress(30 + (i / batches.length) * 60); // 30-90%
}

// –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ - 100%
setLoadingProgress(100);
```

---

### üìà –†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–Ω—ã–π –ø–ª–∞–Ω –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

#### –§–∞–∑–∞ 1 - –ë—ã—Å—Ç—Ä—ã–µ –ø–æ–±–µ–¥—ã (1-2 –¥–Ω—è)

1. ‚úÖ –ò—Å–ø—Ä–∞–≤–∏—Ç—å –æ—à–∏–±–∫—É `context.env` –≤ results/route.js
2. ‚úÖ –ó–∞–º–µ–Ω–∏—Ç—å –≤—Å–µ `console.log` –Ω–∞ `logger`
3. ‚úÖ –£–º–µ–Ω—å—à–∏—Ç—å CACHE_TTL –¥–æ 10 –º–∏–Ω—É—Ç
4. ‚úÖ –£–¥–∞–ª–∏—Ç—å –±–µ—Å–ø–æ–ª–µ–∑–Ω—É—é –ª–æ–≥–∏–∫—É batchSize
5. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∫—ç—à–∞

**–û–∂–∏–¥–∞–µ–º—ã–π —ç—Ñ—Ñ–µ–∫—Ç:** –°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å +, –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å +10%

#### –§–∞–∑–∞ 2 - –ó–Ω–∞—á–∏—Ç–µ–ª—å–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è (3-5 –¥–Ω–µ–π)

1. üîß –†–∞–∑–±–∏—Ç—å page.jsx –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
2. üîß –î–æ–±–∞–≤–∏—Ç—å react-window –¥–ª—è –≤–∏—Ä—Ç—É–∞–ª–∏–∑–∞—Ü–∏–∏
3. üîß –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ª–µ–Ω–∏–≤—É—é –∑–∞–≥—Ä—É–∑–∫—É –≥—Ä—É–ø–ø —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤
4. üîß –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã –∫ Notion (–±–∞—Ç—á–∏–Ω–≥, –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ)

**–û–∂–∏–¥–∞–µ–º—ã–π —ç—Ñ—Ñ–µ–∫—Ç:** –°–∫–æ—Ä–æ—Å—Ç—å –∑–∞–≥—Ä—É–∑–∫–∏ -40-60%, UX ++

#### –§–∞–∑–∞ 3 - –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è (1-2 –Ω–µ–¥–µ–ª–∏)

1. üèóÔ∏è –°–æ–∑–¥–∞—Ç—å Cloudflare Worker –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ KV –æ—á–µ—Ä–µ–¥–∏
2. üèóÔ∏è –í–Ω–µ–¥—Ä–∏—Ç—å Server-Side Streaming
3. üèóÔ∏è –î–æ–±–∞–≤–∏—Ç—å Service Worker –¥–ª—è offline —Ä–µ–∂–∏–º–∞
4. üèóÔ∏è –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω—É—é –∑–∞–≥—Ä—É–∑–∫—É –¥–∞–Ω–Ω—ã—Ö

**–û–∂–∏–¥–∞–µ–º—ã–π —ç—Ñ—Ñ–µ–∫—Ç:** –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å ++, –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å -70%

---

## 3Ô∏è‚É£ –°–¶–ï–ù–ê–†–ò–ô: –û–¢–ü–†–ê–í–ö–ê 150 –û–¶–ï–ù–û–ö –û–î–ù–û–í–†–ï–ú–ï–ù–ù–û

### üî¨ –¢–µ–∫—É—â–µ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ

#### –®–∞–≥ 1: Frontend –æ–±—Ä–∞–±–æ—Ç–∫–∞ (page.jsx:356-369)

```javascript
// 150 –æ–ø–µ—Ä–∞—Ü–∏–π –±—É–¥—É—Ç —Ä–∞–∑–¥–µ–ª–µ–Ω—ã –Ω–∞ –±–∞—Ç—á–∏
const batchOptions = {
  batchSize: 50,        // ‚úÖ 150 –æ–ø–µ—Ä–∞—Ü–∏–π ‚Üí 3 –±–∞—Ç—á–∞ –ø–æ 50
  concurrency: 2,       // ‚úÖ –ú–∞–∫—Å–∏–º—É–º 2 –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–∞
  rateLimitDelay: 3000, // ‚úÖ 3 —Å–µ–∫—É–Ω–¥—ã –º–µ–∂–¥—É –±–∞—Ç—á–∞–º–∏
  maxRetries: 3         // ‚úÖ –î–æ 3 –ø–æ–≤—Ç–æ—Ä–æ–≤ –ø—Ä–∏ –æ—à–∏–±–∫–µ
};
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** 3 –±–∞—Ç—á–∞ –ø–æ 50 –æ–ø–µ—Ä–∞—Ü–∏–π –∫–∞–∂–¥—ã–π.

---

#### –®–∞–≥ 2: Backend –¥–æ–±–∞–≤–ª—è–µ—Ç –≤ KV –æ—á–µ—Ä–µ–¥—å (app/api/batch/submit/route.js:76)

```javascript
const { batchId, jobIds } = await addBatchToKVQueue(operations, processorOptions);
// batchId: "batch_1733234567890_abc123def"
// jobIds: ["job_batch_..._0", "job_batch_..._1", "job_batch_..._2"]
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
- –°–æ–∑–¥–∞–µ—Ç—Å—è 1 batch –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –≤ KV: `queue:batch:{batchId}`
- –°–æ–∑–¥–∞–µ—Ç—Å—è 3 job –∑–∞–ø–∏—Å–∏: `queue:job:{jobId}_0`, `queue:job:{jobId}_1`, `queue:job:{jobId}_2`
- Frontend –ø–æ–ª—É—á–∞–µ—Ç jobIds –¥–ª—è polling

---

#### –®–∞–≥ 3: Frontend polling —Å—Ç–∞—Ç—É—Å–∞ (app/form/[token]/page.jsx)

**–ù–û:** –í —Ç–µ–∫—É—â–µ–º –∫–æ–¥–µ –Ω–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ polling'–∞!

Frontend –ø—Ä–æ—Å—Ç–æ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∏ –∂–¥–µ—Ç –æ—Ç–≤–µ—Ç–∞ –æ—Ç `/api/batch/submit`:

```javascript
const response = await fetch('/api/batch/submit', {
  method: 'POST',
  // ...
});

// ‚ùå –ù–µ—Ç –∫–æ–¥–∞ –¥–ª—è polling /api/batch/status
```

---

#### –®–∞–≥ 4: ‚ùå –ü–†–û–ë–õ–ï–ú–ê - Jobs –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è!

**–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–±–ª–µ–º–∞:** Jobs —Å–æ–∑–¥–∞–Ω—ã –≤ KV, –Ω–æ **–Ω–µ—Ç worker'–∞** –¥–ª—è –∏—Ö –æ–±—Ä–∞–±–æ—Ç–∫–∏!

**–ß—Ç–æ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:**
```javascript
// workers/kv-processor.js (–ù–ï –°–£–©–ï–°–¢–í–£–ï–¢!)
export default {
  async scheduled(event, env, ctx) {
    // –ü–æ–ª—É—á–∏—Ç—å pending jobs –∏–∑ KV
    const jobs = await getKVPendingJobs();

    // –û–±—Ä–∞–±–æ—Ç–∞—Ç—å –∫–∞–∂–¥—ã–π job
    for (const job of jobs) {
      await processJob(job, env);
    }
  }
}
```

**–ß—Ç–æ –µ—Å—Ç—å —Å–µ–π—á–∞—Å:** –ù–ò–ß–ï–ì–û! Jobs –ø—Ä–æ—Å—Ç–æ –ª–µ–∂–∞—Ç –≤ KV.

---

### ‚ö†Ô∏è –ß—Ç–æ –†–ï–ê–õ–¨–ù–û –ø—Ä–æ–∏–∑–æ–π–¥–µ—Ç –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ 150 –æ—Ü–µ–Ω–æ–∫

#### –°—Ü–µ–Ω–∞—Ä–∏–π A: –ï—Å–ª–∏ –ø—Ä–µ–¥–ø–æ–ª–æ–∂–∏—Ç—å, —á—Ç–æ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç

1. **T+0s:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç "–û—Ç–ø—Ä–∞–≤–∏—Ç—å"
2. **T+1s:** 150 –æ–ø–µ—Ä–∞—Ü–∏–π —Ä–∞–∑–¥–µ–ª–µ–Ω—ã –Ω–∞ 3 job'–∞ –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ KV
3. **T+2s:** Worker –Ω–∞—á–∏–Ω–∞–µ—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å Job #1 (50 –æ–ø–µ—Ä–∞—Ü–∏–π)
   - Notion API rate limit: ~3 –∑–∞–ø—Ä–æ—Å–∞/—Å–µ–∫—É–Ω–¥—É
   - –° —É—á–µ—Ç–æ–º `rateLimitDelay=3000ms` –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏:
   - **50 –æ–ø–µ—Ä–∞—Ü–∏–π √ó 3 —Å–µ–∫—É–Ω–¥—ã = ~150 —Å–µ–∫—É–Ω–¥ (2.5 –º–∏–Ω—É—Ç—ã)**

4. **T+152s (2.5 –º–∏–Ω):** Job #1 –∑–∞–≤–µ—Ä—à–µ–Ω, –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è Job #2
5. **T+302s (5 –º–∏–Ω):** Job #2 –∑–∞–≤–µ—Ä—à–µ–Ω, –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è Job #3
6. **T+452s (7.5 –º–∏–Ω):** –í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –∑–∞–≤–µ—Ä—à–µ–Ω—ã

**–ò—Ç–æ–≥–æ: ~7-8 –º–∏–Ω—É—Ç** –¥–ª—è 150 –æ–ø–µ—Ä–∞—Ü–∏–π.

---

#### –°—Ü–µ–Ω–∞—Ä–∏–π B: –¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª—å–Ω–æ—Å—Ç—å (–±–µ–∑ worker'–∞)

1. **T+0s:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç "–û—Ç–ø—Ä–∞–≤–∏—Ç—å"
2. **T+1s:** Jobs —Å–æ–∑–¥–∞–Ω—ã –≤ KV
3. **T+1s:** Frontend –ø–æ–ª—É—á–∞–µ—Ç `batchId` –∏ `jobIds`
4. **T+1s:** Frontend –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç "‚úÖ 150 –æ–ø–µ—Ä–∞—Ü–∏–π –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ"
5. **T+‚àû:** ‚ùå **Jobs –ù–ò–ö–û–ì–î–ê –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è!**

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –û—Ü–µ–Ω–∫–∏ –ù–ï —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ Notion!

---

### üö® –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –ø—Ä–∏ –º–∞—Å—Å–æ–≤–æ–π –æ—Ç–ø—Ä–∞–≤–∫–µ

#### –ü—Ä–æ–±–ª–µ–º–∞ 1: Notion API Rate Limiting

**–õ–∏–º–∏—Ç—ã Notion:**
- –û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π –ª–∏–º–∏—Ç: ~3 requests/second
- Burst: –¥–æ 10 requests –∑–∞ –∫–æ—Ä–æ—Ç–∫–∏–π –ø–µ—Ä–∏–æ–¥
- 429 –æ—à–∏–±–∫–∏ –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏

**–¢–µ–∫—É—â–∞—è –∑–∞—â–∏—Ç–∞:**
- `notionRateLimit.js` - –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–π rate limiter ‚úÖ
- Exponential backoff –ø—Ä–∏ 429 ‚úÖ
- Retry logic (–¥–æ 3 –ø–æ–ø—ã—Ç–æ–∫) ‚úÖ

**–û—Ü–µ–Ω–∫–∞:** ‚úÖ –•–æ—Ä–æ—à–æ –∑–∞—â–∏—â–µ–Ω–æ –æ—Ç rate limiting.

---

#### –ü—Ä–æ–±–ª–µ–º–∞ 2: Cloudflare KV Limits

**–õ–∏–º–∏—Ç—ã KV:**
- ‚úÖ Write: 1000 ops/sec (–¥–ª—è –Ω–∞—à–µ–≥–æ —Å–ª—É—á–∞—è –±–æ–ª–µ–µ —á–µ–º –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ)
- ‚úÖ Value size: 25MB max (150 –æ–ø–µ—Ä–∞—Ü–∏–π ~ 50KB)
- ‚úÖ Key length: 512 chars (–Ω–∞—à–∏ –∫–ª—é—á–∏ ~ 50-80 chars)
- ‚ö†Ô∏è Read: 100,000 ops/sec (–Ω–µ –ø—Ä–æ–±–ª–µ–º–∞, –Ω–æ –ø—Ä–∏ –≤—ã—Å–æ–∫–æ–π –Ω–∞–≥—Ä—É–∑–∫–µ –≤–æ–∑–º–æ–∂–Ω—ã –∑–∞–¥–µ—Ä–∂–∫–∏)

**–û—Ü–µ–Ω–∫–∞:** ‚úÖ KV —Å–ø—Ä–∞–≤–∏—Ç—Å—è —Å –Ω–∞–≥—Ä—É–∑–∫–æ–π.

---

#### –ü—Ä–æ–±–ª–µ–º–∞ 3: Edge Runtime CPU Time Limits

**Cloudflare Pages Functions –ª–∏–º–∏—Ç—ã:**
- CPU time: 50ms –±–µ—Å–ø–ª–∞—Ç–Ω–æ, 30 —Å–µ–∫—É–Ω–¥ max –Ω–∞ Workers Paid
- Memory: 128MB

**–î–ª—è 150 –æ–ø–µ—Ä–∞—Ü–∏–π:**
- –°–æ–∑–¥–∞–Ω–∏–µ jobs –≤ KV: ~200ms ‚úÖ
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ–¥–Ω–æ–≥–æ –±–∞—Ç—á–∞ (50 ops): ~2-3 –º–∏–Ω—É—Ç—ã ‚ö†Ô∏è

**–ü—Ä–æ–±–ª–µ–º–∞:** –ï—Å–ª–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∏–¥–µ—Ç –≤ –æ–¥–Ω–æ–º request, –±—É–¥–µ—Ç timeout!

**–†–µ—à–µ–Ω–∏–µ:** –ù—É–∂–µ–Ω –æ—Ç–¥–µ–ª—å–Ω—ã–π Worker –∏–ª–∏ Cron Trigger –¥–ª—è —Ñ–æ–Ω–æ–≤–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏.

---

#### –ü—Ä–æ–±–ª–µ–º–∞ 4: –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω–æ—Å—Ç–∏

–ï—Å–ª–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–µ—Ä–≤–µ—Ç—Å—è –Ω–∞ 75-–π –æ–ø–µ—Ä–∞—Ü–∏–∏:
- ‚ùå –ù–µ—Ç rollback
- ‚ùå –ù–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ retry –≤—Å–µ–≥–æ –±–∞—Ç—á–∞
- ‚ö†Ô∏è –ß–∞—Å—Ç–∏—á–Ω–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö

**–†–µ—à–µ–Ω–∏–µ:**
```javascript
// –î–æ–±–∞–≤–∏—Ç—å –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å
const operationId = `${pageId}_${field}_${timestamp}`;

// –ü—Ä–æ–≤–µ—Ä—è—Ç—å, –Ω–µ –±—ã–ª–∞ –ª–∏ –æ–ø–µ—Ä–∞—Ü–∏—è —É–∂–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞
if (await isOperationCompleted(operationId)) {
  return; // Skip
}

// –í—ã–ø–æ–ª–Ω–∏—Ç—å –æ–ø–µ—Ä–∞—Ü–∏—é
await updateScore(pageId, field, value);

// –û—Ç–º–µ—Ç–∏—Ç—å –∫–∞–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—É—é
await markOperationCompleted(operationId);
```

---

### üìä –ú–µ—Ç—Ä–∏–∫–∏ –¥–ª—è 150 –æ–ø–µ—Ä–∞—Ü–∏–π

| –ú–µ—Ç—Ä–∏–∫–∞ | –ó–Ω–∞—á–µ–Ω–∏–µ |
|---------|----------|
| **–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–∞—Ç—á–µ–π** | 3 (–ø–æ 50 –æ–ø–µ—Ä–∞—Ü–∏–π) |
| **–í—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è jobs** | ~1-2 —Å–µ–∫—É–Ω–¥—ã |
| **–í—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ (—Å worker'–æ–º)** | 7-10 –º–∏–Ω—É—Ç |
| **–ó–∞–ø—Ä–æ—Å–æ–≤ –∫ Notion API** | 150-450 (—Å —É—á–µ—Ç–æ–º retry) |
| **–ó–∞–ø—Ä–æ—Å–æ–≤ –∫ KV** | 6-10 (write jobs + read status) |
| **–°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –Ω–∞ –æ–ø–µ—Ä–∞—Ü–∏—é** | 3-4 —Å–µ–∫—É–Ω–¥—ã |
| **–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –æ—à–∏–±–æ–∫** | 5-10% (429, network errors) |
| **–£—Å–ø–µ—à–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π** | 135-145 –∏–∑ 150 (90-95%) |

---

### ‚úÖ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è –Ω–∞–¥–µ–∂–Ω–æ–π –º–∞—Å—Å–æ–≤–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏

#### –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ

1. **–°–æ–∑–¥–∞—Ç—å Cloudflare Worker –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—á–µ—Ä–µ–¥–∏**
   ```javascript
   // workers/queue-processor.js
   export default {
     async scheduled(event, env, ctx) {
       const jobs = await getKVPendingJobs(env.NOTION_QUEUE_KV);
       for (const job of jobs) {
         ctx.waitUntil(processJobAsync(job, env));
       }
     }
   }
   ```

2. **–î–æ–±–∞–≤–∏—Ç—å polling –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ**
   ```javascript
   // –ü–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏
   const pollInterval = setInterval(async () => {
     const status = await fetch(`/api/batch/status?jobIds=${jobIds.join(',')}`);
     const data = await status.json();

     if (data.isCompleted) {
       clearInterval(pollInterval);
       showResults(data);
     }

     updateProgress(data.overallProgress);
   }, 2000); // –ö–∞–∂–¥—ã–µ 2 —Å–µ–∫—É–Ω–¥—ã
   ```

3. **–î–æ–±–∞–≤–∏—Ç—å timeout protection**
   ```javascript
   const MAX_POLL_TIME = 15 * 60 * 1000; // 15 –º–∏–Ω—É—Ç
   setTimeout(() => {
     clearInterval(pollInterval);
     showError('–ü—Ä–µ–≤—ã—à–µ–Ω–æ –≤—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è');
   }, MAX_POLL_TIME);
   ```

#### –í–∞–∂–Ω—ã–µ

4. **–î–æ–±–∞–≤–∏—Ç—å progress bar**
5. **–õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤ –æ—Ç–¥–µ–ª—å–Ω—É—é —Ç–∞–±–ª–∏—Ü—É**
6. **–û—Ç–ø—Ä–∞–≤–ª—è—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ (email/Telegram)**

---

## üìù –ò—Ç–æ–≥–æ–≤—ã–µ –≤—ã–≤–æ–¥—ã

### –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã (—Ç—Ä–µ–±—É—é—Ç –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ–≥–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è):

1. ‚ùå **–û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ KV –æ—á–µ—Ä–µ–¥–∏** - –æ—Ü–µ–Ω–∫–∏ –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è!
2. ‚ùå **–û—à–∏–±–∫–∞ –≤ results/route.js** - API endpoint –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
3. ‚ö†Ô∏è **–ù–µ—Ç polling –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ** - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –≤–∏–¥–∏—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:

- ‚úÖ –•–æ—Ä–æ—à–æ: –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ, rate limiting, –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞
- ‚ö†Ô∏è –°—Ä–µ–¥–Ω–µ: –í—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ä–º—ã (3-8 —Å–µ–∫ –±–µ–∑ –∫—ç—à–∞)
- ‚ùå –ü–ª–æ—Ö–æ: –ù–µ—Ç –≤–∏—Ä—Ç—É–∞–ª–∏–∑–∞—Ü–∏–∏, –æ–≥—Ä–æ–º–Ω—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç, –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞

### –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å:

- ‚úÖ Notion API rate limiting –æ–±—Ä–∞–±–æ—Ç–∞–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- ‚úÖ Cloudflare KV —Å–ø—Ä–∞–≤–∏—Ç—Å—è —Å –Ω–∞–≥—Ä—É–∑–∫–æ–π
- ‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç —Ñ–æ–Ω–æ–≤–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–¥–∞—á

---

## üéØ –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–π –ø–ª–∞–Ω –¥–µ–π—Å—Ç–≤–∏–π

### Week 1 - –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

- [ ] –°–æ–∑–¥–∞—Ç—å Cloudflare Worker –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ KV –æ—á–µ—Ä–µ–¥–∏
- [ ] –ò—Å–ø—Ä–∞–≤–∏—Ç—å –æ—à–∏–±–∫—É –≤ results/route.js
- [ ] –î–æ–±–∞–≤–∏—Ç—å polling –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ
- [ ] –î–æ–±–∞–≤–∏—Ç—å progress bar –¥–ª—è –º–∞—Å—Å–æ–≤–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏

### Week 2 - –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

- [ ] –†–∞–∑–±–∏—Ç—å page.jsx –Ω–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
- [ ] –î–æ–±–∞–≤–∏—Ç—å –≤–∏—Ä—Ç—É–∞–ª–∏–∑–∞—Ü–∏—é —Å–ø–∏—Å–∫–∞ (react-window)
- [ ] –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ (–≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ, ETag)
- [ ] –õ–µ–Ω–∏–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –≥—Ä—É–ø–ø —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤

### Week 3 - –ö–∞—á–µ—Å—Ç–≤–æ –∏ –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å

- [ ] –î–æ–±–∞–≤–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ (Sentry, LogDNA)
- [ ] –ù–∞–ø–∏—Å–∞—Ç—å —Ç–µ—Å—Ç—ã –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø—É—Ç–µ–π
- [ ] –î–æ–±–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –æ–ø–µ—Ä–∞—Ü–∏–π
- [ ] –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å API endpoints

---

## üìö –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- [Notion API Rate Limits](https://developers.notion.com/reference/request-limits)
- [Cloudflare Workers](https://developers.cloudflare.com/workers/)
- [Cloudflare KV](https://developers.cloudflare.com/workers/runtime-apis/kv/)
- [React Window](https://github.com/bvaughn/react-window)
- [Next.js Performance](https://nextjs.org/docs/advanced-features/measuring-performance)

---

**–ö–æ–Ω–µ—Ü –æ—Ç—á–µ—Ç–∞**
